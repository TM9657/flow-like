[package]
name = "flow-like-storage"
version = "0.1.0"
edition = "2024"

[dependencies]
flow-like-types.workspace = true
object_store = {version="0.12.4", features = ["gcp", "aws", "azure", "serde", "serde_json", "cloud"] }
lancedb = { version = "0.23.1", features = ["polars", "remote"]}
polars = "0.39.2"
polars-arrow = "0.39.2"
arrow-array = "56.2"
arrow-schema = {version="56.2", features = ["serde"] }
arrow = "56.2"
serde_arrow = { version = "0.13.7", features = ["arrow-56"] }
blake3 = {version = "1.8.1", features = ["rayon"]}
futures.workspace = true
serde = { workspace = true, features = ["derive", "rc"] }
futures-channel = "0.3.31"
crossbeam-channel = "0.5.15"
futures-util = "0.3.31"
urlencoding.workspace = true
schemars.workspace = true
base64.workspace = true
datafusion = { version = "50", default-features = false, features = ["recursive_protection", "regex_expressions", "string_expressions", "unicode_expressions", "array_expressions", "nested_expressions", "math_expressions", "datetime_expressions", "parquet"]}
num_cpus = "1.16"
percent-encoding.workspace = true
infer = "0.19.0"
rig-core.workspace = true
rmcp.workspace = true

# Data lake formats - Delta Lake support (v0.29 compatible with Arrow 56 + DataFusion 50)
deltalake = { version = "0.29", optional = true, default-features = false, features = ["datafusion", "rustls"] }

# Federation support for query push-down to remote databases
# Pinned to exact version to match datafusion-table-providers 0.8.2's requirement
datafusion-federation = { version = "=0.4.10", optional = true }

# Iceberg support from TM9657 fork (compatible with DataFusion 50)
iceberg = { git = "https://github.com/TM9657/iceberg-rust.git", branch = "main", optional = true }
iceberg-datafusion = { git = "https://github.com/TM9657/iceberg-rust.git", branch = "main", optional = true }

[features]
tauri = []
default = []

# Data lake features
delta = ["deltalake"]
iceberg = ["dep:iceberg", "dep:iceberg-datafusion"]
all-lakes = ["delta", "iceberg"]

# Federation feature for query push-down
federation = ["datafusion-federation"]

# Full feature set
full = ["all-lakes", "federation"]
