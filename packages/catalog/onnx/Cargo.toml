[package]
name = "flow-like-catalog-onnx"
version = "0.1.0"
edition = "2024"

[features]
default = []
local-ml = ["flow-like-catalog-core/local-ml", "execute"]

# Execution feature - enables heavy dependencies for node execution
execute = ["flow-like-catalog-core/execute", "dep:tract-tflite", "dep:hound", "dep:tokenizers", "flow-like-model-provider/local-ml"]

# Execution Provider features - optional GPU/NPU acceleration
# These are compile-time optional and gracefully fall back at runtime
cuda = ["flow-like-model-provider/cuda"]
tensorrt = ["flow-like-model-provider/tensorrt"]
coreml = ["flow-like-model-provider/coreml"]
directml = ["flow-like-model-provider/directml"]
xnnpack = ["flow-like-model-provider/xnnpack"]

# Convenience feature for all available EPs on current platform
all-eps = ["cuda", "tensorrt", "coreml", "directml", "xnnpack"]

[dependencies]
flow-like-catalog-core.workspace = true
flow-like.workspace = true
flow-like-types.workspace = true
flow-like-model-provider.workspace = true
flow-like-storage.workspace = true
flow-like-catalog-macros.workspace = true
inventory = "0.3"
ahash.workspace = true
tracing.workspace = true
schemars.workspace = true
futures.workspace = true
serde = { workspace = true, features = ["derive", "rc"] }
tokio = { workspace = true, features = ["rt-multi-thread", "macros"] }
uuid.workspace = true
async-trait.workspace = true
ndarray.workspace = true
sha2 = "0.10"
hex = "0.4"

# Optional execution dependencies
tract-tflite = { git = "https://github.com/TM9657/tract", rev = "ed3b020", optional = true }
hound = { version = "3.5", optional = true }
tokenizers = { version = "0.22.2", optional = true }

[dev-dependencies]
serde_json = "1.0"
reqwest = { version = "0.12", features = ["blocking"] }
image = "0.25"

[[test]]
name = "node_tests"
path = "tests/node_tests.rs"

[[test]]
name = "integration_tests"
path = "tests/integration_tests.rs"
required-features = ["execute"]
