use flow_like::flow::{
    execution::context::ExecutionContext,
    node::{Node, NodeLogic, NodeScores},
    pin::{PinOptions, ValueType},
    variable::VariableType,
};
use flow_like_types::{Value, async_trait, json::json};
#[cfg(feature = "execute")]
use rake::{KeywordSort, Rake, StopWords};
use std::collections::HashSet;
#[cfg(feature = "execute")]
use whatlang::detect;

#[cfg(feature = "execute")]
fn lang_to_code(lang: whatlang::Lang) -> &'static str {
    use whatlang::Lang::*;
    match lang {
        Eng => "en",
        Deu => "de",
        Fra => "fr",
        Spa => "es",
        Ita => "it",
        Por => "pt",
        Nld => "nl",
        Pol => "pl",
        Rus => "ru",
        Tur => "tr",
        Swe => "sv",
        Dan => "da",
        Nob => "no",
        Fin => "fi",
        _ => "en",
    }
}

#[cfg(feature = "execute")]
fn get_stop_words_for_language(lang: &str) -> HashSet<String> {
    match lang {
        "de" => german_stop_words(),
        "fr" => french_stop_words(),
        "es" => spanish_stop_words(),
        "it" => italian_stop_words(),
        "pt" => portuguese_stop_words(),
        "nl" => dutch_stop_words(),
        "pl" => polish_stop_words(),
        "ru" => russian_stop_words(),
        "tr" => turkish_stop_words(),
        "sv" => swedish_stop_words(),
        "da" => danish_stop_words(),
        "no" => norwegian_stop_words(),
        "fi" => finnish_stop_words(),
        _ => english_stop_words(),
    }
}

#[cfg(feature = "execute")]
fn english_stop_words() -> HashSet<String> {
    [
        "a",
        "about",
        "above",
        "after",
        "again",
        "against",
        "all",
        "am",
        "an",
        "and",
        "any",
        "are",
        "aren't",
        "as",
        "at",
        "be",
        "because",
        "been",
        "before",
        "being",
        "below",
        "between",
        "both",
        "but",
        "by",
        "can't",
        "cannot",
        "could",
        "couldn't",
        "did",
        "didn't",
        "do",
        "does",
        "doesn't",
        "doing",
        "don't",
        "down",
        "during",
        "each",
        "few",
        "for",
        "from",
        "further",
        "had",
        "hadn't",
        "has",
        "hasn't",
        "have",
        "haven't",
        "having",
        "he",
        "he'd",
        "he'll",
        "he's",
        "her",
        "here",
        "here's",
        "hers",
        "herself",
        "him",
        "himself",
        "his",
        "how",
        "how's",
        "i",
        "i'd",
        "i'll",
        "i'm",
        "i've",
        "if",
        "in",
        "into",
        "is",
        "isn't",
        "it",
        "it's",
        "its",
        "itself",
        "let's",
        "me",
        "more",
        "most",
        "mustn't",
        "my",
        "myself",
        "no",
        "nor",
        "not",
        "of",
        "off",
        "on",
        "once",
        "only",
        "or",
        "other",
        "ought",
        "our",
        "ours",
        "ourselves",
        "out",
        "over",
        "own",
        "same",
        "shan't",
        "she",
        "she'd",
        "she'll",
        "she's",
        "should",
        "shouldn't",
        "so",
        "some",
        "such",
        "than",
        "that",
        "that's",
        "the",
        "their",
        "theirs",
        "them",
        "themselves",
        "then",
        "there",
        "there's",
        "these",
        "they",
        "they'd",
        "they'll",
        "they're",
        "they've",
        "this",
        "those",
        "through",
        "to",
        "too",
        "under",
        "until",
        "up",
        "very",
        "was",
        "wasn't",
        "we",
        "we'd",
        "we'll",
        "we're",
        "we've",
        "were",
        "weren't",
        "what",
        "what's",
        "when",
        "when's",
        "where",
        "where's",
        "which",
        "while",
        "who",
        "who's",
        "whom",
        "why",
        "why's",
        "with",
        "won't",
        "would",
        "wouldn't",
        "you",
        "you'd",
        "you'll",
        "you're",
        "you've",
        "your",
        "yours",
        "yourself",
        "yourselves",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn german_stop_words() -> HashSet<String> {
    [
        "aber",
        "alle",
        "allem",
        "allen",
        "aller",
        "alles",
        "als",
        "also",
        "am",
        "an",
        "ander",
        "andere",
        "anderem",
        "anderen",
        "anderer",
        "anderes",
        "anders",
        "auch",
        "auf",
        "aus",
        "bei",
        "bin",
        "bis",
        "bist",
        "da",
        "damit",
        "dann",
        "das",
        "dass",
        "daß",
        "dein",
        "deine",
        "deinem",
        "deinen",
        "deiner",
        "deines",
        "dem",
        "den",
        "denn",
        "der",
        "des",
        "dessen",
        "dich",
        "die",
        "dies",
        "diese",
        "dieselbe",
        "dieselben",
        "diesem",
        "diesen",
        "dieser",
        "dieses",
        "dir",
        "doch",
        "dort",
        "du",
        "durch",
        "ein",
        "eine",
        "einem",
        "einen",
        "einer",
        "eines",
        "einig",
        "einige",
        "einigem",
        "einigen",
        "einiger",
        "einiges",
        "einmal",
        "er",
        "es",
        "etwas",
        "euch",
        "euer",
        "eure",
        "eurem",
        "euren",
        "eurer",
        "eures",
        "für",
        "gegen",
        "gewesen",
        "hab",
        "habe",
        "haben",
        "hat",
        "hatte",
        "hatten",
        "hier",
        "hin",
        "hinter",
        "ich",
        "ihm",
        "ihn",
        "ihnen",
        "ihr",
        "ihre",
        "ihrem",
        "ihren",
        "ihrer",
        "ihres",
        "im",
        "in",
        "indem",
        "ins",
        "ist",
        "jede",
        "jedem",
        "jeden",
        "jeder",
        "jedes",
        "jene",
        "jenem",
        "jenen",
        "jener",
        "jenes",
        "jetzt",
        "kann",
        "kein",
        "keine",
        "keinem",
        "keinen",
        "keiner",
        "keines",
        "können",
        "könnte",
        "machen",
        "man",
        "manche",
        "manchem",
        "manchen",
        "mancher",
        "manches",
        "mein",
        "meine",
        "meinem",
        "meinen",
        "meiner",
        "meines",
        "mit",
        "muss",
        "musste",
        "nach",
        "nicht",
        "nichts",
        "noch",
        "nun",
        "nur",
        "ob",
        "oder",
        "ohne",
        "sehr",
        "sein",
        "seine",
        "seinem",
        "seinen",
        "seiner",
        "seines",
        "selbst",
        "sich",
        "sie",
        "sind",
        "so",
        "solche",
        "solchem",
        "solchen",
        "solcher",
        "solches",
        "soll",
        "sollte",
        "sondern",
        "sonst",
        "über",
        "um",
        "und",
        "uns",
        "unse",
        "unsem",
        "unsen",
        "unser",
        "unses",
        "unter",
        "viel",
        "vom",
        "von",
        "vor",
        "während",
        "war",
        "waren",
        "warst",
        "was",
        "weg",
        "weil",
        "weiter",
        "welche",
        "welchem",
        "welchen",
        "welcher",
        "welches",
        "wenn",
        "werde",
        "werden",
        "wie",
        "wieder",
        "will",
        "wir",
        "wird",
        "wirst",
        "wo",
        "wollen",
        "wollte",
        "würde",
        "würden",
        "zu",
        "zum",
        "zur",
        "zwar",
        "zwischen",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn french_stop_words() -> HashSet<String> {
    [
        "ai", "aie", "aient", "aies", "ait", "as", "au", "aura", "aurai", "auraient", "aurais",
        "aurait", "auras", "aurez", "auriez", "aurions", "aurons", "auront", "aux", "avaient",
        "avais", "avait", "avec", "avez", "aviez", "avions", "avons", "ayant", "ayez", "ayons",
        "c", "ce", "ceci", "cela", "celà", "ces", "cet", "cette", "d", "dans", "de", "des", "du",
        "elle", "elles", "en", "est", "et", "eu", "eue", "eues", "eurent", "eus", "eusse",
        "eussent", "eusses", "eussiez", "eussions", "eut", "eûmes", "eût", "eûtes", "furent",
        "fus", "fusse", "fussent", "fusses", "fussiez", "fussions", "fut", "fûmes", "fût", "fûtes",
        "ici", "il", "ils", "j", "je", "l", "la", "le", "les", "leur", "leurs", "lui", "m", "ma",
        "mais", "me", "mes", "moi", "mon", "même", "n", "ne", "ni", "nos", "notre", "nous", "on",
        "ont", "ou", "où", "par", "pas", "pour", "qu", "que", "quel", "quelle", "quelles", "quels",
        "qui", "s", "sa", "sans", "se", "sera", "serai", "seraient", "serais", "serait", "seras",
        "serez", "seriez", "serions", "serons", "seront", "ses", "soi", "soient", "sois", "soit",
        "sommes", "son", "sont", "soyez", "soyons", "suis", "sur", "t", "ta", "te", "tes", "toi",
        "ton", "tu", "un", "une", "vos", "votre", "vous", "y", "à", "étaient", "étais", "était",
        "étant", "étiez", "étions", "été", "étée", "étées", "étés", "êtes",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn spanish_stop_words() -> HashSet<String> {
    [
        "a",
        "al",
        "algo",
        "algunas",
        "algunos",
        "ante",
        "antes",
        "como",
        "con",
        "contra",
        "cual",
        "cuando",
        "de",
        "del",
        "desde",
        "donde",
        "durante",
        "e",
        "el",
        "ella",
        "ellas",
        "ellos",
        "en",
        "entre",
        "era",
        "erais",
        "eran",
        "eras",
        "eres",
        "es",
        "esa",
        "esas",
        "ese",
        "eso",
        "esos",
        "esta",
        "estaba",
        "estabais",
        "estaban",
        "estabas",
        "estad",
        "estada",
        "estadas",
        "estado",
        "estados",
        "estamos",
        "estando",
        "estar",
        "estaremos",
        "estará",
        "estarán",
        "estarás",
        "estaré",
        "estaréis",
        "estaría",
        "estaríais",
        "estaríamos",
        "estarían",
        "estarías",
        "estas",
        "este",
        "estemos",
        "esto",
        "estos",
        "estoy",
        "estuve",
        "estuviera",
        "estuvierais",
        "estuvieran",
        "estuvieras",
        "estuvieron",
        "estuviese",
        "estuvieseis",
        "estuviesen",
        "estuvieses",
        "estuvimos",
        "estuviste",
        "estuvisteis",
        "estuviéramos",
        "estuviésemos",
        "estuvo",
        "está",
        "estábamos",
        "estáis",
        "están",
        "estás",
        "esté",
        "estéis",
        "estén",
        "estés",
        "fue",
        "fuera",
        "fuerais",
        "fueran",
        "fueras",
        "fueron",
        "fuese",
        "fueseis",
        "fuesen",
        "fueses",
        "fui",
        "fuimos",
        "fuiste",
        "fuisteis",
        "fuéramos",
        "fuésemos",
        "ha",
        "habida",
        "habidas",
        "habido",
        "habidos",
        "habiendo",
        "habremos",
        "habrá",
        "habrán",
        "habrás",
        "habré",
        "habréis",
        "habría",
        "habríais",
        "habríamos",
        "habrían",
        "habrías",
        "habéis",
        "había",
        "habíais",
        "habíamos",
        "habían",
        "habías",
        "han",
        "has",
        "hasta",
        "hay",
        "haya",
        "hayamos",
        "hayan",
        "hayas",
        "hayáis",
        "he",
        "hemos",
        "hube",
        "hubiera",
        "hubierais",
        "hubieran",
        "hubieras",
        "hubieron",
        "hubiese",
        "hubieseis",
        "hubiesen",
        "hubieses",
        "hubimos",
        "hubiste",
        "hubisteis",
        "hubiéramos",
        "hubiésemos",
        "hubo",
        "la",
        "las",
        "le",
        "les",
        "lo",
        "los",
        "me",
        "mi",
        "mis",
        "mucho",
        "muchos",
        "muy",
        "más",
        "mí",
        "mía",
        "mías",
        "mío",
        "míos",
        "nada",
        "ni",
        "no",
        "nos",
        "nosotras",
        "nosotros",
        "nuestra",
        "nuestras",
        "nuestro",
        "nuestros",
        "o",
        "os",
        "otra",
        "otras",
        "otro",
        "otros",
        "para",
        "pero",
        "poco",
        "por",
        "porque",
        "que",
        "quien",
        "quienes",
        "qué",
        "se",
        "sea",
        "seamos",
        "sean",
        "seas",
        "seremos",
        "será",
        "serán",
        "serás",
        "seré",
        "seréis",
        "sería",
        "seríais",
        "seríamos",
        "serían",
        "serías",
        "seáis",
        "si",
        "sido",
        "siendo",
        "sin",
        "sobre",
        "sois",
        "somos",
        "son",
        "soy",
        "su",
        "sus",
        "suya",
        "suyas",
        "suyo",
        "suyos",
        "sí",
        "también",
        "tanto",
        "te",
        "tendremos",
        "tendrá",
        "tendrán",
        "tendrás",
        "tendré",
        "tendréis",
        "tendría",
        "tendríais",
        "tendríamos",
        "tendrían",
        "tendrías",
        "tened",
        "tenemos",
        "tenga",
        "tengamos",
        "tengan",
        "tengas",
        "tengo",
        "tengáis",
        "tenida",
        "tenidas",
        "tenido",
        "tenidos",
        "teniendo",
        "tenéis",
        "tenía",
        "teníais",
        "teníamos",
        "tenían",
        "tenías",
        "ti",
        "tiene",
        "tienen",
        "tienes",
        "todo",
        "todos",
        "tu",
        "tus",
        "tuve",
        "tuviera",
        "tuvierais",
        "tuvieran",
        "tuvieras",
        "tuvieron",
        "tuviese",
        "tuvieseis",
        "tuviesen",
        "tuvieses",
        "tuvimos",
        "tuviste",
        "tuvisteis",
        "tuviéramos",
        "tuviésemos",
        "tuvo",
        "tuya",
        "tuyas",
        "tuyo",
        "tuyos",
        "tú",
        "un",
        "una",
        "uno",
        "unos",
        "vosotras",
        "vosotros",
        "vuestra",
        "vuestras",
        "vuestro",
        "vuestros",
        "y",
        "ya",
        "yo",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn italian_stop_words() -> HashSet<String> {
    [
        "a",
        "abbia",
        "abbiamo",
        "abbiano",
        "abbiate",
        "ad",
        "agl",
        "agli",
        "ai",
        "al",
        "all",
        "alla",
        "alle",
        "allo",
        "anche",
        "avemmo",
        "avendo",
        "avesse",
        "avessero",
        "avessi",
        "avessimo",
        "aveste",
        "avesti",
        "avete",
        "aveva",
        "avevamo",
        "avevano",
        "avevate",
        "avevi",
        "avevo",
        "avrai",
        "avranno",
        "avrebbe",
        "avrebbero",
        "avrei",
        "avremmo",
        "avremo",
        "avreste",
        "avresti",
        "avrete",
        "avrà",
        "avrò",
        "avuta",
        "avute",
        "avuti",
        "avuto",
        "c",
        "che",
        "chi",
        "ci",
        "coi",
        "col",
        "come",
        "con",
        "contro",
        "cosa",
        "cui",
        "da",
        "dagl",
        "dagli",
        "dai",
        "dal",
        "dall",
        "dalla",
        "dalle",
        "dallo",
        "degl",
        "degli",
        "dei",
        "del",
        "dell",
        "della",
        "delle",
        "dello",
        "di",
        "dov",
        "dove",
        "e",
        "ebbe",
        "ebbero",
        "ebbi",
        "ed",
        "era",
        "erano",
        "eravamo",
        "eravate",
        "eri",
        "ero",
        "essendo",
        "fa",
        "faccia",
        "facciamo",
        "facciano",
        "facciate",
        "faccio",
        "facemmo",
        "facendo",
        "facesse",
        "facessero",
        "facessi",
        "facessimo",
        "faceste",
        "facesti",
        "faceva",
        "facevamo",
        "facevano",
        "facevate",
        "facevi",
        "facevo",
        "fai",
        "fanno",
        "farai",
        "faranno",
        "farebbe",
        "farebbero",
        "farei",
        "faremmo",
        "faremo",
        "fareste",
        "faresti",
        "farete",
        "farà",
        "farò",
        "fatto",
        "fosse",
        "fossero",
        "fossi",
        "fossimo",
        "foste",
        "fosti",
        "fu",
        "fui",
        "fummo",
        "furono",
        "gli",
        "ha",
        "hai",
        "hanno",
        "ho",
        "i",
        "il",
        "in",
        "io",
        "l",
        "la",
        "le",
        "lei",
        "li",
        "lo",
        "loro",
        "lui",
        "ma",
        "me",
        "mi",
        "mia",
        "mie",
        "miei",
        "mio",
        "ne",
        "negl",
        "negli",
        "nei",
        "nel",
        "nell",
        "nella",
        "nelle",
        "nello",
        "noi",
        "non",
        "nostra",
        "nostre",
        "nostri",
        "nostro",
        "o",
        "per",
        "perché",
        "più",
        "quale",
        "quanta",
        "quante",
        "quanti",
        "quanto",
        "quella",
        "quelle",
        "quello",
        "quest",
        "questa",
        "queste",
        "questi",
        "questo",
        "sarai",
        "saranno",
        "sarebbe",
        "sarebbero",
        "sarei",
        "saremmo",
        "saremo",
        "sareste",
        "saresti",
        "sarete",
        "sarà",
        "sarò",
        "se",
        "sei",
        "si",
        "sia",
        "siamo",
        "siano",
        "siate",
        "siete",
        "sono",
        "sta",
        "stai",
        "stando",
        "stanno",
        "starai",
        "staranno",
        "starebbe",
        "starebbero",
        "starei",
        "staremmo",
        "staremo",
        "stareste",
        "staresti",
        "starete",
        "starà",
        "starò",
        "stava",
        "stavamo",
        "stavano",
        "stavate",
        "stavi",
        "stavo",
        "stemmo",
        "stesse",
        "stessero",
        "stessi",
        "stessimo",
        "steste",
        "stesti",
        "stette",
        "stettero",
        "stetti",
        "stia",
        "stiamo",
        "stiano",
        "stiate",
        "sto",
        "su",
        "sua",
        "sue",
        "sugl",
        "sugli",
        "sui",
        "sul",
        "sull",
        "sulla",
        "sulle",
        "sullo",
        "suo",
        "suoi",
        "ti",
        "tra",
        "tu",
        "tua",
        "tue",
        "tuo",
        "tuoi",
        "tutti",
        "tutto",
        "un",
        "una",
        "uno",
        "vi",
        "voi",
        "vostra",
        "vostre",
        "vostri",
        "vostro",
        "è",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn portuguese_stop_words() -> HashSet<String> {
    [
        "a", "ao", "aos", "aquela", "aquelas", "aquele", "aqueles", "aquilo", "as", "até", "com",
        "como", "da", "das", "de", "dela", "delas", "dele", "deles", "depois", "do", "dos", "e",
        "ela", "elas", "ele", "eles", "em", "entre", "era", "eram", "essa", "essas", "esse",
        "esses", "esta", "estas", "este", "estes", "eu", "foi", "fomos", "for", "fora", "foram",
        "forem", "formos", "fosse", "fossem", "há", "isso", "isto", "já", "lhe", "lhes", "lo",
        "mas", "me", "mesmo", "meu", "meus", "minha", "minhas", "muito", "na", "nas", "nem", "no",
        "nos", "nossa", "nossas", "nosso", "nossos", "num", "numa", "não", "nós", "o", "os", "ou",
        "para", "pela", "pelas", "pelo", "pelos", "por", "qual", "quando", "que", "quem", "se",
        "sem", "ser", "será", "serão", "seu", "seus", "sua", "suas", "são", "só", "também", "te",
        "tem", "tendo", "tenho", "ter", "teu", "teus", "teve", "tinha", "tinham", "tu", "tua",
        "tuas", "tém", "um", "uma", "você", "vocês", "vos", "à", "às", "é", "éramos",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn dutch_stop_words() -> HashSet<String> {
    [
        "aan", "af", "al", "als", "bij", "dan", "dat", "de", "die", "dit", "een", "en", "er",
        "had", "heb", "hem", "het", "hij", "hoe", "hun", "ik", "in", "is", "je", "kan", "me",
        "men", "met", "mij", "nog", "nu", "of", "om", "ook", "op", "ons", "over", "reeds", "te",
        "tegen", "toch", "toen", "tot", "u", "uit", "uw", "van", "veel", "voor", "want", "was",
        "wat", "we", "wel", "werd", "wezen", "wie", "wij", "wil", "worden", "wordt", "zal", "ze",
        "zei", "zelf", "zich", "zij", "zijn", "zo", "zonder", "zou",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn polish_stop_words() -> HashSet<String> {
    [
        "a",
        "aby",
        "ach",
        "acz",
        "aczkolwiek",
        "aj",
        "albo",
        "ale",
        "aż",
        "bardziej",
        "bardzo",
        "bo",
        "bowiem",
        "by",
        "byli",
        "bynajmniej",
        "być",
        "był",
        "była",
        "było",
        "były",
        "będzie",
        "będą",
        "cali",
        "cała",
        "cały",
        "ci",
        "cię",
        "ciebie",
        "co",
        "cokolwiek",
        "coś",
        "czasami",
        "czasem",
        "czemu",
        "czy",
        "czyli",
        "daleko",
        "dla",
        "dlaczego",
        "dlatego",
        "do",
        "dobrze",
        "dokąd",
        "dość",
        "dużo",
        "dwaj",
        "dwie",
        "dwoje",
        "dziś",
        "dzisiaj",
        "gdy",
        "gdyby",
        "gdyż",
        "gdzie",
        "gdziekolwiek",
        "gdzieś",
        "i",
        "ich",
        "ile",
        "im",
        "inna",
        "inne",
        "inny",
        "innych",
        "iż",
        "ja",
        "ją",
        "jak",
        "jakaś",
        "jakby",
        "jaki",
        "jakichś",
        "jakie",
        "jakiś",
        "jakiż",
        "jakkolwiek",
        "jako",
        "jakoś",
        "je",
        "jeden",
        "jedna",
        "jednak",
        "jednakże",
        "jedno",
        "jedynie",
        "jego",
        "jej",
        "jemu",
        "jest",
        "jestem",
        "jeszcze",
        "jeśli",
        "jeżeli",
        "już",
        "ją",
        "każdy",
        "kiedy",
        "kilka",
        "kimś",
        "kto",
        "ktokolwiek",
        "ktoś",
        "która",
        "które",
        "którego",
        "której",
        "który",
        "których",
        "którym",
        "którzy",
        "ku",
        "lat",
        "lecz",
        "lub",
        "ma",
        "mają",
        "mało",
        "mam",
        "mi",
        "mimo",
        "między",
        "mną",
        "mnie",
        "mogą",
        "moi",
        "moim",
        "moja",
        "moje",
        "może",
        "możliwe",
        "można",
        "mój",
        "mu",
        "musi",
        "my",
        "na",
        "nad",
        "nam",
        "nami",
        "nas",
        "nasi",
        "nasz",
        "nasza",
        "nasze",
        "naszego",
        "naszych",
        "natomiast",
        "natychmiast",
        "nawet",
        "nią",
        "nic",
        "nich",
        "nie",
        "niech",
        "niego",
        "niej",
        "niemu",
        "nigdy",
        "nim",
        "nimi",
        "niż",
        "no",
        "o",
        "obok",
        "od",
        "około",
        "on",
        "ona",
        "one",
        "oni",
        "ono",
        "oraz",
        "oto",
        "owszem",
        "pan",
        "pana",
        "pani",
        "po",
        "pod",
        "podczas",
        "pomimo",
        "ponad",
        "ponieważ",
        "powinien",
        "powinna",
        "powinni",
        "powinno",
        "poza",
        "prawie",
        "przecież",
        "przed",
        "przede",
        "przedtem",
        "przez",
        "przy",
        "roku",
        "również",
        "sam",
        "sama",
        "są",
        "się",
        "skąd",
        "sobie",
        "sobą",
        "sposób",
        "swoje",
        "ta",
        "tak",
        "taka",
        "taki",
        "takie",
        "także",
        "tam",
        "te",
        "tego",
        "tej",
        "ten",
        "teraz",
        "też",
        "to",
        "tobą",
        "tobie",
        "toteż",
        "trzeba",
        "tu",
        "tutaj",
        "twoi",
        "twoim",
        "twoja",
        "twoje",
        "twym",
        "twój",
        "ty",
        "tych",
        "tylko",
        "tym",
        "u",
        "w",
        "wam",
        "wami",
        "was",
        "wasz",
        "wasza",
        "wasze",
        "we",
        "według",
        "wiele",
        "wielu",
        "więc",
        "więcej",
        "wszyscy",
        "wszystkich",
        "wszystkie",
        "wszystkim",
        "wszystko",
        "wtedy",
        "wy",
        "właśnie",
        "z",
        "za",
        "zapewne",
        "zawsze",
        "ze",
        "zł",
        "znowu",
        "znów",
        "został",
        "żaden",
        "żadna",
        "żadne",
        "żadnych",
        "że",
        "żeby",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn russian_stop_words() -> HashSet<String> {
    [
        "а",
        "без",
        "более",
        "больше",
        "будет",
        "будто",
        "бы",
        "был",
        "была",
        "были",
        "было",
        "быть",
        "в",
        "вам",
        "вас",
        "ведь",
        "весь",
        "вдруг",
        "вот",
        "все",
        "всего",
        "всех",
        "вы",
        "где",
        "да",
        "даже",
        "два",
        "для",
        "до",
        "другой",
        "его",
        "ее",
        "ей",
        "ему",
        "если",
        "есть",
        "еще",
        "ж",
        "же",
        "за",
        "здесь",
        "и",
        "из",
        "или",
        "им",
        "их",
        "к",
        "как",
        "какой",
        "когда",
        "кто",
        "ли",
        "либо",
        "мне",
        "может",
        "мы",
        "на",
        "надо",
        "наконец",
        "нас",
        "не",
        "него",
        "нее",
        "ней",
        "нет",
        "ни",
        "них",
        "но",
        "ну",
        "о",
        "об",
        "один",
        "он",
        "она",
        "они",
        "оно",
        "опять",
        "от",
        "перед",
        "по",
        "под",
        "после",
        "потом",
        "потому",
        "почти",
        "при",
        "про",
        "раз",
        "разве",
        "с",
        "сам",
        "свое",
        "свою",
        "себе",
        "себя",
        "сейчас",
        "со",
        "совсем",
        "так",
        "такой",
        "там",
        "тебя",
        "тем",
        "теперь",
        "то",
        "тогда",
        "того",
        "тоже",
        "той",
        "только",
        "том",
        "тот",
        "три",
        "тут",
        "ты",
        "у",
        "уж",
        "уже",
        "хорошо",
        "хоть",
        "чего",
        "чей",
        "чем",
        "через",
        "что",
        "чтоб",
        "чтобы",
        "чуть",
        "эти",
        "этого",
        "этой",
        "этом",
        "этот",
        "эту",
        "я",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn turkish_stop_words() -> HashSet<String> {
    [
        "acaba",
        "ama",
        "aslında",
        "az",
        "bazı",
        "belki",
        "beri",
        "bile",
        "bir",
        "birçok",
        "biri",
        "birkaç",
        "birkez",
        "birşey",
        "birşeyi",
        "biz",
        "bize",
        "bizden",
        "bizi",
        "bizim",
        "böyle",
        "böylece",
        "bu",
        "buna",
        "bunda",
        "bundan",
        "bunlar",
        "bunları",
        "bunların",
        "bunu",
        "bunun",
        "burada",
        "çok",
        "çünkü",
        "da",
        "daha",
        "dahi",
        "de",
        "defa",
        "değil",
        "diğer",
        "diye",
        "dolayı",
        "dolayısıyla",
        "dört",
        "edecek",
        "eden",
        "ederek",
        "edilecek",
        "ediliyor",
        "edilmesi",
        "ediyor",
        "eğer",
        "en",
        "etmesi",
        "etti",
        "ettiği",
        "ettiğini",
        "gibi",
        "göre",
        "hala",
        "hangi",
        "hatta",
        "hem",
        "henüz",
        "hep",
        "hepsi",
        "her",
        "herhangi",
        "herkes",
        "herkesi",
        "herkez",
        "hiç",
        "hiçbir",
        "için",
        "içinde",
        "iki",
        "ile",
        "ilgili",
        "ise",
        "işte",
        "kadar",
        "karşın",
        "kendi",
        "kendine",
        "kendini",
        "kendisi",
        "kendisine",
        "kendisini",
        "kez",
        "ki",
        "kim",
        "kime",
        "kimi",
        "kimse",
        "madem",
        "mı",
        "mi",
        "mu",
        "mü",
        "nasıl",
        "ne",
        "neden",
        "nedir",
        "nerde",
        "nerede",
        "nereye",
        "nesi",
        "neyi",
        "neyse",
        "niçin",
        "niye",
        "o",
        "olan",
        "olarak",
        "oldu",
        "olduğu",
        "olduğunu",
        "olduklarını",
        "olmak",
        "olması",
        "olmayan",
        "olmaz",
        "olsa",
        "olsun",
        "olup",
        "olur",
        "olursa",
        "oluyor",
        "on",
        "ona",
        "ondan",
        "onlar",
        "onlara",
        "onlardan",
        "onları",
        "onların",
        "onu",
        "onun",
        "orada",
        "öyle",
        "oysa",
        "pek",
        "rağmen",
        "sadece",
        "sanki",
        "şey",
        "şeyi",
        "şeyler",
        "şimdi",
        "şöyle",
        "şu",
        "şuna",
        "şunları",
        "şunu",
        "tabi",
        "tamam",
        "tüm",
        "tümü",
        "üç",
        "üzere",
        "var",
        "vardı",
        "ve",
        "veya",
        "ya",
        "yani",
        "yapacak",
        "yapılan",
        "yapılması",
        "yapıyor",
        "yapmak",
        "yaptı",
        "yaptığı",
        "yaptığını",
        "yaptıkları",
        "yine",
        "yoksa",
        "zaten",
        "zira",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn swedish_stop_words() -> HashSet<String> {
    [
        "alla", "allt", "att", "av", "bli", "blev", "blir", "blivit", "de", "dem", "den", "denna",
        "deras", "dess", "dessa", "det", "detta", "dig", "din", "dina", "ditt", "du", "där", "då",
        "efter", "ej", "eller", "en", "er", "era", "ert", "ett", "från", "för", "ha", "hade",
        "han", "hans", "har", "henne", "hennes", "hon", "honom", "hur", "här", "i", "icke",
        "ingen", "inom", "inte", "jag", "ju", "kan", "kunde", "man", "med", "mellan", "men", "mig",
        "min", "mina", "mitt", "mot", "mycket", "ni", "nu", "när", "någon", "något", "några",
        "och", "om", "oss", "på", "samma", "sedan", "sig", "sin", "sina", "sitta", "själv",
        "skall", "skulle", "som", "så", "sådan", "sådana", "sådant", "till", "under", "upp", "ut",
        "utan", "var", "vara", "varit", "varför", "vi", "vid", "vill", "vilka", "vilken", "vilket",
        "vår", "våra", "vårt", "än", "är", "åt", "över",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn danish_stop_words() -> HashSet<String> {
    [
        "af", "alle", "alt", "anden", "andre", "at", "blev", "blive", "bliver", "da", "de", "dem",
        "den", "denne", "der", "deres", "det", "dette", "dig", "din", "dine", "disse", "dit",
        "dog", "du", "efter", "eller", "en", "end", "er", "et", "for", "fordi", "fra", "få", "får",
        "før", "god", "godt", "ham", "han", "hans", "har", "havde", "have", "hende", "hendes",
        "her", "hos", "hun", "hvad", "hvem", "hver", "hvilke", "hvilken", "hvis", "hvor",
        "hvordan", "hvorfor", "hvornår", "i", "ikke", "ind", "ingen", "intet", "jeg", "jer",
        "jeres", "jo", "kan", "kom", "komme", "kommer", "kun", "kunne", "lidt", "lige", "lille",
        "man", "mand", "mange", "med", "meget", "men", "mig", "min", "mine", "mit", "mod", "må",
        "ned", "nej", "noget", "nogle", "nok", "nu", "når", "og", "også", "om", "op", "os", "over",
        "på", "selv", "sig", "sin", "sine", "sit", "skal", "skulle", "som", "sådan", "så", "thi",
        "til", "ud", "under", "var", "ved", "vi", "vil", "ville", "vor", "vores", "være", "været",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn norwegian_stop_words() -> HashSet<String> {
    [
        "alle",
        "at",
        "av",
        "bare",
        "begge",
        "ble",
        "blei",
        "bli",
        "blir",
        "blitt",
        "både",
        "båe",
        "da",
        "de",
        "deg",
        "dei",
        "deim",
        "deira",
        "deires",
        "dem",
        "den",
        "denne",
        "der",
        "dere",
        "deres",
        "det",
        "dette",
        "di",
        "din",
        "dine",
        "disse",
        "ditt",
        "du",
        "dykk",
        "dykkar",
        "då",
        "eg",
        "ein",
        "eit",
        "eitt",
        "eller",
        "elles",
        "en",
        "enn",
        "er",
        "et",
        "ett",
        "etter",
        "for",
        "fordi",
        "fra",
        "før",
        "ha",
        "hadde",
        "han",
        "hans",
        "har",
        "hennar",
        "henne",
        "hennes",
        "her",
        "hjå",
        "ho",
        "hoe",
        "honom",
        "hoss",
        "hossen",
        "hun",
        "hva",
        "hvem",
        "hver",
        "hvilke",
        "hvilken",
        "hvis",
        "hvor",
        "hvordan",
        "hvorfor",
        "i",
        "ikke",
        "ikkje",
        "ingen",
        "ingi",
        "inkje",
        "inn",
        "inni",
        "ja",
        "jeg",
        "kan",
        "kom",
        "korleis",
        "korso",
        "kun",
        "kunne",
        "kva",
        "kvar",
        "kvarhelst",
        "kven",
        "kvi",
        "kvifor",
        "man",
        "mange",
        "me",
        "med",
        "medan",
        "meg",
        "meget",
        "mellom",
        "men",
        "mi",
        "min",
        "mine",
        "mitt",
        "mot",
        "mykje",
        "må",
        "ned",
        "no",
        "noe",
        "noen",
        "noka",
        "noko",
        "nokon",
        "nokor",
        "nokre",
        "nå",
        "når",
        "og",
        "også",
        "om",
        "opp",
        "oss",
        "over",
        "på",
        "same",
        "samme",
        "seg",
        "selv",
        "si",
        "sia",
        "sidan",
        "siden",
        "sin",
        "sine",
        "sitt",
        "sjøl",
        "skal",
        "skulle",
        "slik",
        "so",
        "som",
        "somme",
        "somt",
        "så",
        "til",
        "um",
        "under",
        "upp",
        "ut",
        "uten",
        "var",
        "vart",
        "varte",
        "ved",
        "vere",
        "veri",
        "verte",
        "vi",
        "vil",
        "ville",
        "vore",
        "vors",
        "vort",
        "vår",
        "være",
        "vært",
        "å",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[cfg(feature = "execute")]
fn finnish_stop_words() -> HashSet<String> {
    [
        "alla",
        "alle",
        "ei",
        "eivät",
        "emme",
        "en",
        "et",
        "ette",
        "että",
        "he",
        "heidän",
        "heidät",
        "heihin",
        "heille",
        "heillä",
        "heiltä",
        "heissä",
        "heistä",
        "heitä",
        "hän",
        "häneen",
        "hänelle",
        "hänellä",
        "häneltä",
        "hänen",
        "hänessä",
        "hänestä",
        "hänet",
        "häntä",
        "itse",
        "ja",
        "jo",
        "johon",
        "joiden",
        "joihin",
        "joiksi",
        "joilla",
        "joille",
        "joilta",
        "joissa",
        "joista",
        "joita",
        "joka",
        "jokainen",
        "jokin",
        "joko",
        "joku",
        "jolla",
        "jolle",
        "jolta",
        "jona",
        "jonka",
        "jonne",
        "jos",
        "jossa",
        "josta",
        "jota",
        "joten",
        "jotenkin",
        "jotka",
        "jotta",
        "jotain",
        "juuri",
        "kaikkialla",
        "kaikki",
        "kanssa",
        "kauemmas",
        "keneksi",
        "kenelle",
        "kenellä",
        "keneltä",
        "kenen",
        "kenessä",
        "kenestä",
        "kenet",
        "ketä",
        "koska",
        "koskaan",
        "kuka",
        "kukaan",
        "kukin",
        "kumpi",
        "kumpikaan",
        "kun",
        "kunnes",
        "kuten",
        "kyllä",
        "liian",
        "lisää",
        "me",
        "meidän",
        "meidät",
        "meihin",
        "meille",
        "meillä",
        "meiltä",
        "meissä",
        "meistä",
        "meitä",
        "mihin",
        "miksi",
        "mikä",
        "mikään",
        "mikäli",
        "mille",
        "milloin",
        "millä",
        "miltä",
        "minkä",
        "minne",
        "minua",
        "minulla",
        "minulle",
        "minulta",
        "minun",
        "minussa",
        "minusta",
        "minut",
        "minä",
        "missä",
        "mistä",
        "mitä",
        "mitään",
        "miten",
        "moi",
        "molemmat",
        "mu",
        "mua",
        "mukaan",
        "mutta",
        "muualle",
        "muualla",
        "muualta",
        "muuanne",
        "muu",
        "muut",
        "muuta",
        "muutama",
        "muuten",
        "myös",
        "näiden",
        "näihin",
        "näille",
        "näillä",
        "näiltä",
        "näin",
        "näissä",
        "näistä",
        "näitä",
        "nämä",
        "ne",
        "niin",
        "niiden",
        "niihin",
        "niille",
        "niillä",
        "niiltä",
        "niissä",
        "niistä",
        "niitä",
        "noin",
        "nopeammin",
        "nuo",
        "nyt",
        "ohi",
        "olla",
        "ollessa",
        "oman",
        "on",
        "ovat",
        "poikki",
        "päin",
        "päälle",
        "saakka",
        "sama",
        "samaa",
        "sanojen",
        "se",
        "sekä",
        "sen",
        "siellä",
        "siihen",
        "siinä",
        "siitä",
        "siksi",
        "sille",
        "silloin",
        "sillä",
        "silti",
        "sinne",
        "sinua",
        "sinulla",
        "sinulle",
        "sinulta",
        "sinun",
        "sinussa",
        "sinusta",
        "sinut",
        "sinä",
        "sisälle",
        "sitä",
        "sitten",
        "suoraan",
        "taa",
        "tähän",
        "täällä",
        "tällä",
        "tämä",
        "tämän",
        "tänne",
        "tänään",
        "taas",
        "tai",
        "takaa",
        "takia",
        "tavalla",
        "te",
        "teidän",
        "teidät",
        "teihin",
        "teille",
        "teillä",
        "teiltä",
        "teissä",
        "teistä",
        "teitä",
        "tuo",
        "tuohon",
        "tuolla",
        "tuolle",
        "tuolta",
        "tuon",
        "tuonne",
        "tuossa",
        "tuosta",
        "tuota",
        "tälle",
        "tältä",
        "tässä",
        "tästä",
        "tätä",
        "ulkopuolella",
        "vaan",
        "vai",
        "vaikka",
        "välillä",
        "varsin",
        "vastaan",
        "vielä",
        "vieläkin",
        "voi",
        "yhdessä",
        "yhtä",
        "yhtään",
        "yli",
        "ympäri",
    ]
    .iter()
    .map(|s| s.to_string())
    .collect()
}

#[crate::register_node]
#[derive(Default)]
pub struct RakeExtractionNode {}

impl RakeExtractionNode {
    pub fn new() -> Self {
        RakeExtractionNode {}
    }
}

#[async_trait]
impl NodeLogic for RakeExtractionNode {
    fn get_node(&self) -> Node {
        let mut node = Node::new(
            "ai_processing_rake_extraction",
            "RAKE Keywords",
            "Extracts keywords from text using the RAKE (Rapid Automatic Keyword Extraction) algorithm. RAKE is a domain-independent algorithm that extracts significant phrases by analyzing word frequency and co-occurrence.",
            "AI/Processing",
        );
        node.add_icon("/flow/icons/key.svg");

        node.set_scores(
            NodeScores::new()
                .set_privacy(10)
                .set_security(10)
                .set_performance(9)
                .set_governance(10)
                .set_reliability(9)
                .set_cost(10)
                .build(),
        );

        node.add_input_pin(
            "text",
            "Text",
            "The text to extract keywords from",
            VariableType::String,
        )
        .set_default_value(Some(json!("")));

        node.add_input_pin(
            "language",
            "Language",
            "Language for stop words. Use 'auto' for automatic detection.",
            VariableType::String,
        )
        .set_default_value(Some(json!("auto")))
        .set_options(
            PinOptions::new()
                .set_valid_values(vec![
                    "auto".to_string(),
                    "en".to_string(),
                    "de".to_string(),
                    "fr".to_string(),
                    "es".to_string(),
                    "it".to_string(),
                    "pt".to_string(),
                    "nl".to_string(),
                    "pl".to_string(),
                    "ru".to_string(),
                    "tr".to_string(),
                    "sv".to_string(),
                    "da".to_string(),
                    "no".to_string(),
                    "fi".to_string(),
                ])
                .build(),
        );

        node.add_input_pin(
            "stop_words",
            "Stop Words",
            "Custom stop words to filter out (optional). Overrides language-based stop words if provided.",
            VariableType::String,
        )
        .set_value_type(ValueType::HashSet)
        .set_default_value(Some(json!([])));

        node.add_input_pin(
            "min_score",
            "Min Score",
            "Minimum score threshold for keywords (0.0 = no filter)",
            VariableType::Float,
        )
        .set_default_value(Some(json!(0.0)));

        node.add_input_pin(
            "max_keywords",
            "Max Keywords",
            "Maximum number of keywords to return (0 = unlimited)",
            VariableType::Integer,
        )
        .set_default_value(Some(json!(0)));

        node.add_output_pin(
            "keywords",
            "Keywords",
            "Extracted keywords as a string set",
            VariableType::String,
        )
        .set_value_type(ValueType::HashSet);

        node
    }

    #[cfg(feature = "execute")]
    async fn run(&self, context: &mut ExecutionContext) -> flow_like_types::Result<()> {
        let text: String = context.evaluate_pin("text").await?;
        let language: String = context.evaluate_pin("language").await?;
        let custom_stop_words: HashSet<Value> = context.evaluate_pin("stop_words").await?;
        let min_score: f64 = context.evaluate_pin("min_score").await?;
        let max_keywords: i64 = context.evaluate_pin("max_keywords").await?;

        let stop_words: StopWords = if !custom_stop_words.is_empty() {
            custom_stop_words
                .iter()
                .filter_map(|v| v.as_str().map(|s| s.to_string()))
                .collect::<HashSet<String>>()
                .into()
        } else {
            let lang_code = if language == "auto" {
                detect(&text)
                    .map(|info| lang_to_code(info.lang()))
                    .unwrap_or("en")
            } else {
                &language
            };
            get_stop_words_for_language(lang_code).into()
        };

        let rake = Rake::new(stop_words);
        let mut keywords = rake.run(&text);

        keywords.sort_by_score();

        let result: HashSet<String> = keywords
            .into_iter()
            .filter(|kw| kw.score >= min_score)
            .take(if max_keywords > 0 {
                max_keywords as usize
            } else {
                usize::MAX
            })
            .map(|kw| kw.keyword)
            .collect();

        context.set_pin_value("keywords", json!(result)).await?;
        Ok(())
    }

    #[cfg(not(feature = "execute"))]
    async fn run(&self, _context: &mut ExecutionContext) -> flow_like_types::Result<()> {
        Err(flow_like_types::anyhow!(
            "Processing requires the 'execute' feature"
        ))
    }
}
