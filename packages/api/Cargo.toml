[package]
name = "flow-like-api"
version = "0.1.0"
edition = "2024"

[build-dependencies]
serde = { workspace = true, features = ["derive", "rc"] }
serde_json.workspace = true
flow-like-types.workspace = true
reqwest = { version = "0.12.15", features = ["blocking"] }

[dependencies]
axum.workspace = true
sea-orm.workspace = true
serde = { workspace = true, features = ["derive", "rc"] }
pin-project-lite = "0.2.16"
tower.workspace = true
flow-like.workspace = true
flow-like-types.workspace = true
flow-like-storage.workspace = true
flow-like-sinks.workspace = true
flow-like-wasm.workspace = true
serde_json.workspace = true
base64.workspace = true
jsonwebtoken.workspace = true
hyper.workspace = true
hyper-util.workspace = true
tracing.workspace = true
tower-http.workspace = true
chrono.workspace = true
oasgen = {version="0.25.0", features = ["axum"]}
async-stripe.workspace = true
bitflags.workspace = true
futures.workspace = true
futures-util.workspace = true
bytes.workspace = true
moka.workspace = true
blake3.workspace = true
aes-gcm = "0.10"
getrandom = "0.3"
p256 = "0.13.2"
async-trait.workspace = true
thiserror.workspace = true
parking_lot = "0.12"
hex = "0.4.3"
ipnetwork = "0.21.1"
ed25519-dalek = "2.2"

# ---- AWS dependencies ----
aws-config = {workspace = true, optional=true}
aws-sdk-sts = {workspace = true, optional=true}
aws-sdk-sesv2 = {workspace = true, optional=true}
aws-sdk-lambda = {workspace = true, optional=true}
aws-sdk-sqs = {workspace = true, optional=true}
# -----

# ----- Azure dependencies ----
hmac = { version = "0.12", optional = true }
sha2 = { version = "0.10", optional = true }
urlencoding = { workspace = true, optional = true }
# -----

# ----- GCP dependencies ----
rsa = { version = "0.9", optional = true }
# -----

# ----- Cognito dependencies ----
aws-sdk-cognitoidentityprovider = {version="1.89.0", optional=true}
# -----

# ----- Mail dependencies ----
lettre = {workspace = true, optional=true}
reqwest = {workspace = true}
async-stream = "0.3"
eventsource-stream = "0.2"
# -----

# ----- Kubernetes dependencies ----
kube = { workspace = true, optional = true }
k8s-openapi = { workspace = true, optional = true }
# -----

# ----- State store dependencies ----
redis = { version = "0.27", features = ["tokio-comp", "connection-manager"], optional = true }
tokio = { workspace = true, features = ["sync", "time"], optional = true }
aws-sdk-dynamodb = { version = "1", optional = true }
aws-sdk-s3 = { version = "1", optional = true }
# -----

[features]
default = ["aws", "cognito", "ses", "smtp", "sendgrid"]
aws = ["aws-config", "aws-sdk-sts"]
azure = ["hmac", "sha2", "urlencoding"]
gcp = ["sha2", "rsa", "urlencoding"]
r2 = []  # Cloudflare R2 with proprietary temp credentials API
cognito = ["aws-sdk-cognitoidentityprovider", "aws-config"]
ses = ["aws-sdk-sesv2", "aws-config"]
smtp = ["lettre"]
sendgrid = []
local = []
kubernetes = ["kube", "k8s-openapi"]
lambda = ["aws-config", "aws-sdk-lambda"]
sqs = ["aws-config", "aws-sdk-sqs"]
# State store backends
redis = ["dep:redis", "dep:tokio"]
dynamodb = ["aws-config", "aws-sdk-dynamodb"]  # Uses FlowLikeStore (object_store) for large payloads
s3 = ["aws-config", "aws-sdk-s3"]
full=[
    "aws",
    "azure",
    "gcp",
    "r2",
    "local",
    "ses",
    "smtp",
    "sendgrid",
    "redis",
    "dynamodb",
    "s3",
]
urlencoding = ["dep:urlencoding"]

[dev-dependencies]
tokio = { workspace = true, features = ["macros", "rt-multi-thread"] }
dotenv = { workspace = true }
