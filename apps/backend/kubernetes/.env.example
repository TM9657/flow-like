# =============================================================================
# Flow-Like Kubernetes Backend - Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# Database type: internal | external
#   internal - CockroachDB deployed within the cluster (default, recommended)
#   external - Bring your own PostgreSQL/CockroachDB
DATABASE_TYPE=internal

# For external database only:
# DATABASE_URL=postgresql://user:password@your-host:5432/flowlike

# -----------------------------------------------------------------------------
# Redis Configuration (Job Queue + Execution State)
# -----------------------------------------------------------------------------
# Redis is deployed internally for job queuing
REDIS_HOST=redis
REDIS_PORT=6379
# REDIS_URL is auto-constructed by the chart

# Execution state backend: redis (recommended for Kubernetes)
EXECUTION_STATE_BACKEND=redis
EXECUTION_STATE_TTL_SECONDS=86400

# -----------------------------------------------------------------------------
# Storage Provider Configuration
# -----------------------------------------------------------------------------
# Options: aws, azure, gcp, r2, s3
#   aws   - Native AWS S3 with STS support
#   azure - Native Azure Blob Storage
#   gcp   - Native Google Cloud Storage
#   r2    - Cloudflare R2 (S3-compatible)
#   s3    - Generic S3-compatible storage
STORAGE_PROVIDER=aws

# Bucket/Container names (generic - works across all providers)
META_BUCKET=flow-like-meta
CONTENT_BUCKET=flow-like-content
LOG_BUCKET=flow-like-logs

# -----------------------------------------------------------------------------
# AWS S3 Configuration (when STORAGE_PROVIDER=aws)
# -----------------------------------------------------------------------------
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-1
AWS_USE_PATH_STYLE=false

# Role ARN for scoped credentials (optional but recommended)
# Used to generate short-lived STS credentials for isolated user/app access
# Example: arn:aws:iam::123456789012:role/FlowLikeRuntimeRole
RUNTIME_ROLE_ARN=

# -----------------------------------------------------------------------------
# Cloudflare R2 Configuration (when STORAGE_PROVIDER=r2)
# -----------------------------------------------------------------------------
R2_ACCOUNT_ID=
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
# Optional: custom bucket names
# R2_META_BUCKET=flow-like-meta
# R2_CONTENT_BUCKET=flow-like-content

# -----------------------------------------------------------------------------
# Azure Blob Storage Configuration (when STORAGE_PROVIDER=azure)
# -----------------------------------------------------------------------------
AZURE_STORAGE_ACCOUNT_NAME=
AZURE_STORAGE_ACCOUNT_KEY=
# Optional: container name overrides
# AZURE_META_CONTAINER=flow-like-meta
# AZURE_CONTENT_CONTAINER=flow-like-content

# -----------------------------------------------------------------------------
# GCP Cloud Storage Configuration (when STORAGE_PROVIDER=gcp)
# -----------------------------------------------------------------------------
GCP_PROJECT_ID=
# Base64-encoded or raw service account JSON
GOOGLE_APPLICATION_CREDENTIALS_JSON=
# Optional: bucket name overrides
# GCP_META_BUCKET=flow-like-meta
# GCP_CONTENT_BUCKET=flow-like-content

# -----------------------------------------------------------------------------
# S3-Compatible Storage Configuration (when STORAGE_PROVIDER=s3)
# -----------------------------------------------------------------------------
S3_ENDPOINT=
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_USE_PATH_STYLE=true

# -----------------------------------------------------------------------------
# API Service Configuration
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8080
RUST_LOG=info,k8s_api=debug

# -----------------------------------------------------------------------------
# Execution Backend Configuration
# -----------------------------------------------------------------------------
# EXECUTION_BACKEND: Backend for sync/streaming requests (/invoke)
#   http           - HTTP to warm executor pool (default, recommended)
#   kubernetes_job - Create isolated K8s Job per execution (slower, more isolated)
#   redis          - Queue to Redis (consumed by executor pool)
EXECUTION_BACKEND=http

# ASYNC_EXECUTION_BACKEND: Backend for async requests (/invoke/async)
#   redis          - Queue to Redis (default, recommended for K8s)
#   http           - Direct HTTP to executor pool
#   kubernetes_job - Create isolated K8s Job per execution
ASYNC_EXECUTION_BACKEND=redis

# Executor pool URL (for http backend)
EXECUTOR_URL=http://executor-pool:8080

# -----------------------------------------------------------------------------
# Executor Configuration
# -----------------------------------------------------------------------------
K8S_NAMESPACE=flow-like
K8S_EXECUTOR_IMAGE=flow-like/executor:latest
USE_KATA_CONTAINERS=false
JOB_TIMEOUT=3600
MAX_CONCURRENT_JOBS=100

# -----------------------------------------------------------------------------
# Monitoring (Optional)
# -----------------------------------------------------------------------------
METRICS_ENABLED=true
METRICS_PORT=9090
