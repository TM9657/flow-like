---
import { LuCircleCheck, LuTrendingUp, LuZap } from "react-icons/lu";
import type { Lang, TranslationKey } from "../i18n";
import { translations, defaultLang } from "../i18n";

interface Props {
  lang?: Lang;
}

const { lang = defaultLang } = Astro.props;
const t = (key: TranslationKey): string => {
  const langTranslations = translations[lang] as Record<string, string>;
  const enTranslations = translations.en as Record<string, string>;
  return langTranslations?.[key] ?? enTranslations[key] ?? key;
};
---

<section
  id="typed"
  class="relative mx-auto max-w-7xl px-4 py-28 lg:px-8 overflow-hidden md:overflow-visible"
  data-c1="hsl(0 100% 63% / .06)"
  data-c2="hsl(21 89% 67% / .06)"
>
  <!-- decorative bg -->
  <div aria-hidden="true" class="pointer-events-none absolute inset-0 -z-10">
    <div
      class="absolute inset-0 bg-[radial-gradient(60%_60%_at_15%_25%,var(--c1,transparent),transparent)]"
    >
    </div>
    <div
      class="absolute inset-0 bg-[radial-gradient(60%_60%_at_85%_35%,var(--c2,transparent),transparent)]"
    >
    </div>
    <div
      class="absolute inset-0 [mask-image:radial-gradient(70%_70%_at_50%_40%,black,transparent)] bg-[linear-gradient(to_right,theme(colors.muted.DEFAULT/.12)_1px,transparent_1px),linear-gradient(to_bottom,theme(colors.muted.DEFAULT/.12)_1px,transparent_1px)] bg-[size:36px_36px]"
    >
    </div>
    <!-- Animated glow orbs -->
    <div class="ztp-glow ztp-glow-1"></div>
    <div class="ztp-glow ztp-glow-2"></div>
  </div>

  <div class="relative z-10">
    <!-- Headline -->
    <div class="mx-auto max-w-4xl text-center reveal">
      <div
        class="inline-flex items-center gap-2.5 rounded-full border border-primary/30 bg-primary/10 backdrop-blur-xl px-5 py-2.5 text-sm font-semibold text-primary mb-8 shadow-[0_0_30px_-8px_hsl(var(--primary)/.4)] hover:shadow-[0_0_40px_-5px_hsl(var(--primary)/.5)] transition-all duration-500 group"
      >
        <span class="w-2 h-2 rounded-full bg-primary shadow-[0_0_8px_rgba(var(--primary),0.6)]"></span>
        <span>{t("zerotoprod.tagline")}</span>
      </div>

      <h2
        class="text-4xl font-bold sm:text-5xl lg:text-6xl bg-gradient-to-r from-foreground via-primary to-secondary bg-clip-text text-transparent leading-tight"
      >
        {t("zerotoprod.headline")} <span class="text-primary">{t("zerotoprod.headline.highlight")}</span>
      </h2>

      <p class="mt-6 text-lg text-muted-foreground max-w-3xl mx-auto">
        {t("zerotoprod.description")}
      </p>
    </div>

    <!-- Animated pipeline: Dev → Staging → Prod -->
    <div class="mt-10">
      <ol
        class="mx-auto max-w-3xl flex items-center justify-between gap-3 rounded-2xl border border-border/40 bg-card/40 backdrop-blur-sm px-4 py-3 reveal"
      >
        <li class="flex items-center gap-2">
          <span class="size-2 rounded-full bg-emerald-500 animate-pulse"></span>
          <span class="text-sm font-medium">{t("zerotoprod.stages.dev")}</span>
        </li>
        <div class="relative h-1 flex-1">
          <div class="absolute inset-0 rounded-full bg-muted/50"></div>
          <div class="absolute inset-0 rounded-full overflow-hidden">
            <div
              class="h-full w-[160%] animate-flow bg-[linear-gradient(90deg,theme(colors.primary.DEFAULT/.0),theme(colors.primary.DEFAULT/.6),theme(colors.secondary.DEFAULT/.0))]"
            >
            </div>
          </div>
        </div>
        <li class="flex items-center gap-2">
          <span
            class="size-2 rounded-full bg-amber-500 animate-pulse [animation-delay:.2s]"
          ></span>
          <span class="text-sm font-medium">{t("zerotoprod.stages.staging")}</span>
        </li>
        <div class="relative h-1 flex-1">
          <div class="absolute inset-0 rounded-full bg-muted/50"></div>
          <div class="absolute inset-0 rounded-full overflow-hidden">
            <div
              class="h-full w-[160%] animate-flow bg-[linear-gradient(90deg,theme(colors.primary.DEFAULT/.0),theme(colors.primary.DEFAULT/.6),theme(colors.secondary.DEFAULT/.0))] [animation-delay:.15s]"
            >
            </div>
          </div>
        </div>
        <li class="flex items-center gap-2">
          <span
            class="size-2 rounded-full bg-primary animate-pulse [animation-delay:.4s]"
          ></span>
          <span class="text-sm font-medium">{t("zerotoprod.stages.prod")}</span>
        </li>
      </ol>
      <p class="mt-2 text-center text-xs text-muted-foreground reveal">
        {t("zerotoprod.stages.note")}
      </p>
    </div>

    <!-- Feature cards -->
    <div class="mt-14 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <!-- 1 -->
      <article
        class="ztp-card group reveal"
      >
        <div class="ztp-card-glow ztp-card-glow-primary"></div>
        <div class="relative z-10">
          <div
            class="w-12 h-12 bg-gradient-to-br from-primary to-primary/60 rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-primary/20"
          >
            <LuCircleCheck className="w-6 h-6 text-primary-foreground" />
          </div>
          <h3 class="text-xl font-bold mb-3">Ready to ship by default</h3>
          <p class="text-muted-foreground leading-relaxed">
            Checks catch broken connections and mismatched data before you run.
            Flows stay shippable as they evolve — not just demo-ready.
          </p>
        </div>
      </article>

      <!-- 2 -->
      <article
        class="ztp-card group reveal"
      >
        <div class="ztp-card-glow ztp-card-glow-secondary"></div>
        <div class="relative z-10">
          <div
            class="w-12 h-12 bg-gradient-to-br from-secondary to-secondary/60 rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-secondary/20"
          >
            <LuZap className="w-6 h-6 text-secondary-foreground" />
          </div>
          <h3 class="text-xl font-bold mb-3">Change with confidence</h3>
          <p class="text-muted-foreground leading-relaxed">
            When something changes, Flow-Like shows what changed and whether it
            still fits. Review diffs, keep contracts intact, and avoid breakage.
          </p>
        </div>
      </article>

      <!-- 3 -->
      <article
        class="ztp-card group reveal md:col-span-2 lg:col-span-1"
      >
        <div class="ztp-card-glow ztp-card-glow-tertiary"></div>
        <div class="relative z-10">
          <div
            class="w-12 h-12 bg-gradient-to-br from-tertiary to-tertiary/60 rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-tertiary/20"
          >
            <LuTrendingUp className="w-6 h-6 text-tertiary-foreground" />
          </div>
          <h3 class="text-xl font-bold mb-3">Predictable in production</h3>
          <p class="text-muted-foreground leading-relaxed">
            Each step records inputs and outputs, so issues are easy to spot as
            traffic grows. Runs stay steady and explainable — no <span
              class="p-1 px-2 bg-black font-bold text-black rounded-md transition-all group-hover:bg-black/10 group-hover:text-black border-black border-2 black-box"
              >black-boxes</span
            >.
          </p>
        </div>
      </article>
    </div>
  </div>

  <!-- helpers -->
  <script is:inline>
    (() => {
      const reduce = matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;

      // reveal-on-view
      const reveals = document.querySelectorAll("#typed .reveal");
      if (reveals.length && !reduce) {
        const io = new IntersectionObserver(
          (entries) => {
            entries.forEach((e) => {
              if (e.isIntersecting) {
                e.target.classList.add("in");
                io.unobserve(e.target);
              }
            });
          },
          { threshold: 0.12 },
        );
        reveals.forEach((el) => io.observe(el));
      } else {
        reveals.forEach((el) => el.classList.add("in"));
      }

      // on touch devices simulate group-hover with a tap
      try {
        const touchDevice = matchMedia?.("(hover: none) and (pointer: coarse)")?.matches || 'ontouchstart' in window;
        if (touchDevice) {
          const groups = document.querySelectorAll("#typed .group");
          groups.forEach((group) => {
            group.addEventListener("click", (e) => {
              // avoid toggling when clicking interactive elements inside the card
              if (e.target.closest("a,button,input,textarea,select")) return;
              group.classList.toggle("tapped");
            });
          });
          // tap outside to clear any tapped states
          document.addEventListener(
            "click",
            (e) => {
              if (!e.target.closest("#typed .group")) {
                document.querySelectorAll("#typed .group.tapped").forEach((g) => g.classList.remove("tapped"));
              }
            },
            true,
          );
        }
      } catch (err) {
        // fail silently on older browsers
      }
    })();
  </script>

  <style>
    :where(#typed) {
      --c1: attr(data-c1);
      --c2: attr(data-c2);
    }

    /* Background glows - BIGGER */
    .ztp-glow {
      position: absolute;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.4;
      animation: ztp-float 12s ease-in-out infinite;
    }

    .ztp-glow-1 {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, hsl(var(--primary) / 0.5) 0%, transparent 60%);
      top: 0%;
      left: 5%;
    }

    .ztp-glow-2 {
      width: 550px;
      height: 550px;
      background: radial-gradient(circle, hsl(var(--secondary) / 0.4) 0%, transparent 60%);
      bottom: 5%;
      right: 5%;
      animation-delay: 6s;
    }

    @keyframes ztp-float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -25px) scale(1.1); }
      66% { transform: translate(-20px, 15px) scale(0.92); }
    }

    /* Feature cards - more dramatic */
    .ztp-card {
      position: relative;
      overflow: hidden;
      border-radius: 1.5rem;
      border: 1px solid color-mix(in oklch, var(--border) 60%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in oklch, var(--card) 90%, transparent),
        color-mix(in oklch, var(--card) 60%, transparent)
      );
      backdrop-filter: blur(24px);
      padding: 2rem;
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .ztp-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: color-mix(in oklch, var(--primary) 50%, transparent);
      box-shadow:
        0 30px 80px -20px rgba(0, 0, 0, 0.35),
        0 0 60px -20px hsl(var(--primary) / 0.3);
    }

    /* Card hover glows - stronger */
    .ztp-card-glow {
      position: absolute;
      inset: -2px;
      border-radius: inherit;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .ztp-card:hover .ztp-card-glow {
      opacity: 1;
    }

    .ztp-card-glow-primary {
      background: radial-gradient(circle at 20% 20%, hsl(var(--primary) / 0.2) 0%, transparent 55%);
    }

    .ztp-card-glow-secondary {
      background: radial-gradient(circle at 80% 80%, hsl(var(--secondary) / 0.2) 0%, transparent 55%);
    }

    .ztp-card-glow-tertiary {
      background: radial-gradient(circle at 20% 50%, hsl(var(--tertiary) / 0.2) 0%, transparent 55%);
    }

    /* reveal animation */
    #typed .reveal {
      opacity: 0;
      transform: translateY(12px);
      transition:
        opacity 0.6s ease,
        transform 0.6s ease;
    }
    #typed .reveal.in {
      opacity: 1;
      transform: none;
    }

    /* flowing gradient in the pipeline */
    @keyframes flow {
      0% {
        transform: translateX(-60%);
      }
      100% {
        transform: translateX(0%);
      }
    }
    .animate-flow {
      animation: flow 2.2s linear infinite;
    }

    /* make taps behave like group-hover on touch devices */
    #typed .group .black-box {
      transition: background-color .2s, color .2s;
    }
    #typed .group:hover .black-box,
    #typed .group.tapped .black-box {
      /* mirror group-hover:bg-black/10 and group-hover:text-black */
      background-color: rgba(0,0,0,0.10);
      color: #000;
    }

    @media (prefers-reduced-motion: reduce) {
      .ztp-glow { animation: none; }
      .ztp-card { transition: none; }
    }
  </style>
</section>
