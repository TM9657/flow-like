---
import { getCollection } from 'astro:content';
import PostCard from '../../components/post-card.astro';
import "@tm9657/flow-like-ui/global.css";
import "../../styles/Blog.css";
import BlogLayout from '../../layouts/Blog-Layout.astro';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const all = (await getCollection('blog', ({ data }) => import.meta.env.PROD ? !data.draft : true))
    .sort((a,b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(all, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const first = page.data[0];
const rest = page.data.slice(1);
---
<BlogLayout data={{ title: "Blog", description: "Latest blog posts", slug: "blog" }}>
  <main class="mx-auto max-w-4xl p-2 flex grow flex-col items-start justify-start gap-8">
    <h1 class="sr-only">Blog</h1>

    {first && <PostCard entry={first} variant="lead" />}

    <section class="mt-6 flex flex-col gap-8">
      {rest.map(p => <PostCard entry={p} variant="compact" />)}
    </section>

    {page.lastPage > 1 && (
      <nav class="mt-10 flex gap-2 items-center" aria-label="Blog pagination">
        {page.url.prev && (
          <a
            href={page.url.prev}
            class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-800"
          >
            Previous
          </a>
        )}

        {Array.from({length: page.lastPage}, (_, i) => i + 1).map(i => (
          <a
            href={i === 1 ? '/blog' : `/blog/${i}`}
            aria-current={i === page.currentPage ? 'page' : undefined}
            class={`px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-800 ${i === page.currentPage ? 'bg-zinc-200 dark:bg-zinc-700 font-medium' : ''}`}
          >
            {i}
          </a>
        ))}

        {page.url.next && (
          <a
            href={page.url.next}
            class="px-3 py-1 rounded border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-800"
          >
            Next
          </a>
        )}
      </nav>
    )}
  </main>
</BlogLayout>
