---
import "@tm9657/flow-like-ui/global.css";
import { BlogHeader } from "../components/blog-header";
import LanguageDetect from "../components/language-detect.astro";

import AmbientGlow from "../components/ambient-glow.astro";
import SoftSeam from "../components/soft-seam.astro";

import DesignWorkflowsVisually from "../sections/design-workflows-visually.astro";
import ZeroToProd from "../sections/zero-to-prod.astro";
import Hero from "../sections/hero.astro";
import FAQ from "../sections/faq.astro";
import Portability from "../sections/portability.astro";
import Performance from "../sections/performance.astro";
import Extensibility from "../sections/extensibility.astro";
import Theming from "../sections/theming.astro";
import ProcessCombination from "../sections/process-combination.astro";
import Storage from "../sections/storage.astro";
import ProblemSolution from "../sections/problem-solution.astro";
import Reading from "../sections/reading.astro";
import FlowPilot from "../sections/flowpilot.astro";
import Integrations from "../sections/integrations.astro";
import UseCases from "../sections/use-cases.astro";
import CtaAutomate from "../sections/cta-automate.astro";
import TwentyFourHourBanner from "../sections/24-hour-solution-banner.astro";
import EnterpriseStack from "../sections/enterprise-stack.astro";
import EnterpriseServices from "../sections/enterprise-services.astro";
import TargetAudience from "../sections/target-audience.astro";
import Newsletter from "../sections/newsletter.astro";
import { BlogFooter } from "../components/blog-footer";

// --- SEO constants ---
const site = "https://flow-like.com";
const title = "Flow-Like — Enterprise Automation You Can Trust (Auditable, On-Prem, Secure)";
const description =
  "Mission-critical automation you can audit, control and run on-prem. No black boxes. No silent failures. No data leaks. Built for teams that cannot afford uncertainty.";
const keywords = [
  "enterprise automation","workflow automation","on-premise automation","auditable workflows",
  "visual programming","typed workflows","Rust","compliance","governance","secure automation"
].join(", ");
const appName = "Flow-Like";
const orgName = "TM9657 GmbH";
const canonicalUrl = site;
const ogImage = `${site}/og.png`;
const ogImageAlt = "Flow-Like — Enterprise Automation You Can Trust";
const twitterCard = "summary_large_image";

const github = "https://github.com/TM9657/flow-like";
const docs = "https://docs.flow-like.com";
const download = "https://github.com/TM9657/flow-like/releases";

// --- JSON-LD blocks ---
const ldOrganization = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: orgName,
  url: site,
  logo: `${site}/favicon.svg`,
  sameAs: [github, docs]
};

const ldSoftware = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  name: appName,
  applicationCategory: "DeveloperApplication",
  applicationSubCategory: "Workflow automation",
  operatingSystem: "macOS, Windows, Linux",
  url: site,
  downloadUrl: download,
  image: ogImage,
  description,
  license: `${github}/blob/main/LICENSE`
};

const ldWebSite = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: appName,
  url: site,
  publisher: {
    "@type": "Organization",
    name: orgName
  },
  inLanguage: "en"
};

const ldWebPage = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  url: site,
  name: title,
  description,
  isPartOf: {
    "@type": "WebSite",
    url: site,
    name: appName
  },
  inLanguage: "en"
};
---

<!doctype html>
<html lang="en" class="scroll-smooth max-w-full overflow-x-hidden" style="overflow-x: hidden;">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="application-name" content={appName} />
    <meta name="apple-mobile-web-app-title" content={appName} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="color-scheme" content="light dark" />
    <meta name="format-detection" content="telephone=no, address=no, email=no, url=no" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <meta name="generator" content={Astro.generator} />

    <!-- Canonical & alternates -->
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" hreflang="en" href={site} />
    <link rel="alternate" hreflang="de" href={`${site}/de`} />
    <link rel="alternate" hreflang="es" href={`${site}/es`} />
    <link rel="alternate" hreflang="fr" href={`${site}/fr`} />
    <link rel="alternate" hreflang="zh" href={`${site}/zh`} />
    <link rel="alternate" hreflang="ja" href={`${site}/ja`} />
    <link rel="alternate" hreflang="ko" href={`${site}/ko`} />
    <link rel="alternate" hreflang="pt" href={`${site}/pt`} />
    <link rel="alternate" hreflang="it" href={`${site}/it`} />
    <link rel="alternate" hreflang="nl" href={`${site}/nl`} />
    <link rel="alternate" hreflang="sv" href={`${site}/sv`} />
    <link rel="alternate" hreflang="x-default" href={site} />
    <link rel="alternate" type="application/rss+xml" title="Flow-Like Blog" href="/rss.xml" />

    <!-- Favicons / PWA -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0ea5e9" />
    <meta name="msapplication-TileColor" content="#0ea5e9" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content={appName} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={site} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:alt" content={ogImageAlt} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content={twitterCard} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <meta name="twitter:image:alt" content={ogImageAlt} />

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://docs.flow-like.com" crossorigin />
    <link rel="preconnect" href="https://github.com" crossorigin />

    <!-- Structured Data (inline, non-blocking) -->
    <script type="application/ld+json">{JSON.stringify(ldOrganization)}</script>
    <script type="application/ld+json">{JSON.stringify(ldSoftware)}</script>
    <script type="application/ld+json">{JSON.stringify(ldWebSite)}</script>
    <script type="application/ld+json">{JSON.stringify(ldWebPage)}</script>

    <!-- Language detection - runs before page renders -->
    <LanguageDetect />

    <!-- Performance helpers -->
    <style is:global>
     body {
        background-image: radial-gradient(
          color-mix(in srgb, var(--muted) 20%, transparent) 1px,
          transparent 1px
        ) !important;
        background-size: 16px 16px !important;
        background-attachment: scroll !important;
      }
      html, body { overflow-x: clip; }
      @media (hover: none) and (pointer: coarse) {
        /* Keep decorative overlays passive on touch without disabling legit fixed UI */
        [data-overlay], [data-visual], .overlay, .backdrop {
          pointer-events: none;
          touch-action: pan-y;
        }

        /* Disable scroll snapping & smooth scroll on phones */
        * { scroll-snap-type: none !important; }
        html { scroll-behavior: auto !important; }

        /* Don’t allow sections to create nested scrollers or crop content */
        html, body, main, section, [role="region"] {
          overflow: visible !important;
        }

        /* Sticky/fixed inside sections can break the scroll chain after style changes */
        .sticky, [style*="position: sticky"] { position: static !important; }
      }

      html, body { min-height: 100%; }
      html, body {
        overflow-y: auto;
        overflow-x: hidden !important;
        max-width: 100vw;
        -webkit-overflow-scrolling: touch;
        touch-action: pan-y;
      }
      :root, body, #content {
        overscroll-behavior: auto;
      }
    </style>
  </head>

  <body
    class="bg-background text-foreground antialiased selection:bg-primary/30 selection:text-primary-foreground overflow-x-hidden max-w-full
            bg-[radial-gradient(var(--muted)_1px,transparent_1px)] [background-size:16px_16px]"
  >
    <script is:inline>
      // DEV: horizontal overflow detector (remove in production if undesired)
      (function(){
        try {
          const vw = () => document.documentElement.clientWidth;
          const offenders = [];
          document.querySelectorAll('*').forEach(function(el){
            var sw = el.scrollWidth;
            if (sw > vw() + 1) {
              var styles = getComputedStyle(el);
              if (styles.overflowX === 'hidden' || styles.position === 'fixed') return;
              offenders.push({el: el, sw: sw, cls: el.className});
            }
          });
          if (offenders.length) {
            window.__overflowOffenders = offenders;
            console.warn('[Overflow detector] Elements exceeding viewport width:', offenders.slice(0,5));
          }
        } catch(e) {}
      })();
    </script>
    <main id="content" class="w-full">
      <AmbientGlow />
      <BlogHeader client:load/>
      <Hero client:load/>

      <!-- Enterprise Stack - what you get -->
      <EnterpriseStack />

      <!-- CTA -->
      <CtaAutomate />

      <!-- Problem/Solution - the hidden risk & flow-like difference -->
      <ProblemSolution />

      <!-- Use Cases -->
      <UseCases />

      <!-- Visual builder showcase -->
      <DesignWorkflowsVisually />

      <!-- Target Audience -->
      <TargetAudience />

      <!-- Enterprise Services -->
      <EnterpriseServices />

      <!-- 24 Hour Solution Banner -->
      <TwentyFourHourBanner />

      <!-- Core features: Portability -->
      <Portability />

      <SoftSeam />
      <Performance />

      <!-- FlowPilot - prominent AI feature -->
      <FlowPilot />

      <Extensibility />

      <!-- Zero to Prod -->
      <ZeroToProd />

      <!-- Dark section: Integrations -->
      <Integrations />

      <SoftSeam />
      <Theming />

      <SoftSeam />
      <ProcessCombination />

      <SoftSeam />
      <Storage />

      <Reading />

      <Newsletter />

      <FAQ />
    </main>

    <BlogFooter  />
  </body>
</html>
