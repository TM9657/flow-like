---
title: State Management Nodes
description: Manage global and page-local state in A2UI applications
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

# State Management Nodes

State management nodes allow workflows to store and retrieve data that persists across workflow executions. There are two types of state:

- **Global State**: Shared across all pages, persists for the session
- **Page State**: Scoped to a specific page, persists when navigating

Both types are automatically persisted to IndexedDB, surviving page refreshes.

---

## Global State

### Get Global State

Retrieves a value from global state by key.

#### Inputs

| Pin | Type | Description |
|-----|------|-------------|
| Key | String | The key to retrieve |

#### Outputs

| Pin | Type | Description |
|-----|------|-------------|
| Value | Generic | The stored value (any type) |
| Exists | Boolean | Whether the key exists |

---

### Set Global State

Stores a value in global state.

#### Inputs

| Pin | Type | Description |
|-----|------|-------------|
| ▶ Exec In | Execution | Triggers the update |
| Key | String | The key to store under |
| Value | Generic | The value to store |

#### Outputs

| Pin | Type | Description |
|-----|------|-------------|
| ▶ Exec Out | Execution | Continues after storing |

---

## Page State

### Get Page State

Retrieves a value from the current page's state.

#### Inputs

| Pin | Type | Description |
|-----|------|-------------|
| Key | String | The key to retrieve |

#### Outputs

| Pin | Type | Description |
|-----|------|-------------|
| Value | Generic | The stored value |
| Exists | Boolean | Whether the key exists |

---

### Set Page State

Stores a value in the current page's state.

#### Inputs

| Pin | Type | Description |
|-----|------|-------------|
| ▶ Exec In | Execution | Triggers the update |
| Key | String | The key to store under |
| Value | Generic | The value to store |

#### Outputs

| Pin | Type | Description |
|-----|------|-------------|
| ▶ Exec Out | Execution | Continues after storing |

<Aside type="note">
Page state is keyed by the current route. Navigating to `/users/1` and `/users/2` creates separate page states.
</Aside>

---

## Global vs Page State

<Tabs>
  <TabItem label="Global State">
    **Use for:**
    - User authentication info
    - User preferences
    - Shopping cart
    - App-wide settings
    - Cached API responses

    **Characteristics:**
    - Available on all pages
    - Persists across navigation
    - Survives page refresh
    - Cleared on logout/app close
  </TabItem>
  <TabItem label="Page State">
    **Use for:**
    - Form draft data
    - Filter/sort settings
    - Scroll position
    - Expanded/collapsed state
    - Page-specific cache

    **Characteristics:**
    - Scoped to route
    - Preserved when navigating away and back
    - Survives page refresh
    - Different instances for different route params
  </TabItem>
</Tabs>

---

## State in Workflow Payload

When a workflow is triggered, both states are included in the payload:

```json
{
  "_global_state": {
    "userId": "user_123",
    "theme": "dark",
    "cartItems": [...]
  },
  "_page_state": {
    "filterBy": "active",
    "sortOrder": "asc",
    "selectedItems": [1, 2, 3]
  },
  "_page_id": "/dashboard"
}
```

---

## Persistence

Both global and page state are automatically persisted to IndexedDB:

<Steps>
1. **On Set** - Value is stored in memory AND written to IndexedDB
2. **On Page Load** - State is restored from IndexedDB
3. **On Navigation** - Page state for new page is loaded from IndexedDB
</Steps>

This means state survives:
- Page refreshes
- Browser back/forward
- Navigation between pages
- App restarts (within same browser)

<Aside type="caution">
IndexedDB storage is per-origin (domain). State is not shared between different domains or browser profiles.
</Aside>

---

## Common Patterns

### User Authentication State

```
[Login API Call]
   → [Set Global State: "userId" = response.userId]
   → [Set Global State: "userRole" = response.role]
   → [Navigate To: "/dashboard"]
```

```
[Page Load]
   → [Get Global State: "userId"]
   → [Branch: exists]
      ├─ False: [Navigate To: "/login"]
      └─ True: [Load User Data]
```

### Form Draft Auto-Save

```
[Input Changed]
   → [Get Element Value: "form-field"]
   → [Set Page State: "draft_field" = value]
```

```
[Page Load]
   → [Get Page State: "draft_field"]
   → [Branch: exists]
      └─ True: [Set Element Value: "form-field" = value]
```

### Filter Persistence

```
[Filter Changed]
   → [Get Select Value: "filter-dropdown"]
   → [Set Page State: "activeFilter" = value]
   → [Refresh Data]
```

```
[Page Load]
   → [Get Page State: "activeFilter"]
   → [Branch: exists]
      ├─ True: [Set Select Value: "filter-dropdown" = value]
      └─ False: [Set Select Value: "filter-dropdown" = "all"]
```

### Shopping Cart (Cross-Page)

```
[Add to Cart Button]
   → [Get Global State: "cart"]
   → [Append Item to Array]
   → [Set Global State: "cart" = updated_cart]
   → [Update Cart Badge]
```

The cart is accessible from any page.

### Multi-Step Form Wizard

```
[Step 1 Complete]
   → [Get All Form Values]
   → [Set Global State: "wizard_step1" = values]
   → [Navigate To: "/wizard/step2"]
```

```
[Step 2 Load]
   → [Get Global State: "wizard_step1"]
   → [Branch: exists]
      ├─ False: [Navigate To: "/wizard/step1"]
      └─ True: [Continue]
```

---

## Best Practices

1. **Use descriptive keys** - Prefix keys by feature: `cart_items`, `user_preferences`
2. **Don't store sensitive data** - IndexedDB is not encrypted
3. **Clean up stale data** - Remove state when no longer needed
4. **Use page state for page-specific data** - Don't pollute global state
5. **Consider data size** - Large arrays/objects impact performance
