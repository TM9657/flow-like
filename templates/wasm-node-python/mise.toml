[tools]
python = "3.12"
uv = "latest"

[tasks.wit-copy]
description = "Copy canonical WIT from packages/wasm/wit/"
run = "mkdir -p wit && cp ../../packages/wasm/wit/flow-like-node.wit wit/flow-like-node.wit"

[tasks.wit-clean]
description = "Remove local WIT copy"
run = "rm -rf wit"

[tasks.setup]
description = "Install dependencies"
run = "uv sync --group dev --group build"

[tasks.build]
description = "Build the WASM node"
depends = ["wit-copy"]
run = "uv run python build.py"

[tasks.build-definition]
description = "Extract node definition only"
run = "uv run python build.py --definition-only"

[tasks.test]
description = "Run tests"
run = "uv run pytest -v"

[tasks.clean]
description = "Clean build artifacts"
run = ["rm -rf build/ dist/ *.egg-info .pytest_cache", "rm -rf wit"]
